<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>РЕГЛАМЕНТ-digial РОССЕТИ КУБАНЬ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f7fa;
            color: #333;
            line-height: 1.5;
        }

        .header {
            background: #1e3c72;
            color: white;
            padding: 1.5rem 2rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 1.5rem;
            margin-bottom: 0.75rem;
            font-weight: 500;
        }

        .controls {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
            align-items: center;
        }

        select, input[type="text"] {
            padding: 0.5rem 0.75rem;
            border: none;
            border-radius: 4px;
            font-size: 0.9rem;
            background: white;
            color: #333;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            transition: box-shadow 0.2s ease;
        }

        select {
            min-width: 280px;
            cursor: pointer;
        }

        input[type="text"] {
            flex: 1;
            min-width: 250px;
        }

        input[type="text"]:focus, select:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(30, 60, 114, 0.1);
        }

        .container {
            max-width: 1200px;
            margin: 1.5rem auto;
            padding: 0 1.5rem;
        }

        .section-card {
            background: white;
            border-radius: 6px;
            margin-bottom: 0.75rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
            transition: box-shadow 0.2s ease;
        }

        .section-card:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.12);
        }

        .section-header {
            padding: 1rem 1.25rem;
            background: #fafbfc;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #e9ecef;
        }

        .section-title {
            font-size: 0.95rem;
            font-weight: 600;
            color: #1e3c72;
            letter-spacing: 0.3px;
        }

        .section-arrow {
            transition: transform 0.2s ease;
            font-size: 0.9rem;
            color: #6c757d;
        }

        .section-arrow.expanded {
            transform: rotate(180deg);
        }

        .section-content {
            padding: 1.25rem;
            display: none;
        }

        .section-content.expanded {
            display: block;
        }

        .algorithm-block {
            margin-bottom: 1rem;
        }

        .algorithm-block:last-child {
            margin-bottom: 0;
        }

        .algorithm-block h4 {
            color: #1e3c72;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .algorithm-block ul, .algorithm-block ol {
            margin-left: 1.25rem;
            margin-top: 0.3rem;
        }

        .algorithm-block li {
            margin-bottom: 0.25rem;
            color: #495057;
            font-size: 0.9rem;
        }

        .algorithm-block p {
            font-size: 0.9rem;
            color: #495057;
            margin: 0.3rem 0;
        }

        .action-buttons {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #e9ecef;
        }

        .action-btn {
            padding: 0.4rem 0.75rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 500;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
        }

        .btn-primary {
            background: #1e3c72;
            color: white;
        }

        .btn-primary:hover {
            background: #162d56;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-secondary {
            background: #e9ecef;
            color: #495057;
        }

        .btn-secondary:hover {
            background: #dee2e6;
        }

        .floating-buttons {
            position: fixed;
            bottom: 1.5rem;
            right: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            z-index: 1000;
        }

        .floating-btn {
            background: #1e3c72;
            color: white;
            border: none;
            padding: 0.75rem;
            border-radius: 50%;
            width: 48px;
            height: 48px;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            transition: all 0.2s ease;
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .floating-btn:hover {
            background: #162d56;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .highlight {
            background-color: #fff3cd;
            padding: 1px 3px;
            border-radius: 2px;
        }

        .no-results {
            text-align: center;
            padding: 2.5rem;
            color: #6c757d;
            font-size: 0.95rem;
        }

        .source-modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 3% auto;
            padding: 1.5rem;
            border-radius: 6px;
            width: 85%;
            max-width: 900px;
            max-height: 85vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }

        .modal-content h2 {
            font-size: 1.25rem;
            margin-bottom: 1rem;
            color: #1e3c72;
        }

        .close-modal {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 1.25rem;
            cursor: pointer;
            color: #6c757d;
            line-height: 1;
            padding: 0.25rem;
        }

        .close-modal:hover {
            color: #333;
        }

        @media (max-width: 768px) {
            .header {
                padding: 1rem 1.25rem;
            }
            
            .header h1 {
                font-size: 1.25rem;
            }
            
            .controls {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            select, input[type="text"] {
                width: 100%;
                min-width: auto;
            }
            
            .section-header {
                padding: 0.875rem 1rem;
            }
            
            .section-title {
                font-size: 0.875rem;
            }
            
            .action-buttons {
                flex-wrap: wrap;
            }
            
            .action-btn {
                padding: 0.375rem 0.625rem;
                font-size: 0.75rem;
            }
            
            .floating-buttons {
                bottom: 1rem;
                right: 1rem;
                gap: 0.5rem;
            }
            
            .floating-btn {
                width: 44px;
                height: 44px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>РЕГЛАМЕТ-digital <span>• РОССЕТИ КУБАНЬ</span></h1>
        <div class="controls">
            <select id="reglamentSelect">
                <option value="r057-2022">Р 057-2022 - Работа по выявлению неучтенного потребления</option>
                <option value="other" disabled>Другие регламенты (будут добавлены)</option>
            </select>
            <input type="text" id="searchInput" placeholder="Поиск по ключевым словам...">
        </div>
    </div>

    <div class="container" id="contentContainer">
        <!-- Содержимое будет динамически генерироваться -->
    </div>

    <div class="floating-buttons">
        <button class="floating-btn" id="collapseAllBtn" title="Свернуть все">▼</button>
        <button class="floating-btn" id="scrollTopBtn" title="Наверх" style="display: none;">▲</button>
    </div>

    <div id="sourceModal" class="source-modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>Исходный документ</h2>
            <div id="sourceText"></div>
        </div>
    </div>

    <script>
        // Данные алгоритмов
        const algorithms = {
            'r057-2022': [
                {
                    id: 'normative',
                    title: 'НОРМАТИВНЫЕ ПОЛОЖЕНИЯ',
                    content: {
                        actions: [
                            { text: 'Изучить и применять в работе' }
                        ],
                        responsible: 'Все сотрудники',
                        deadline: 'Постоянно'
                    }
                },
                {
                    id: 'general',
                    title: 'ОБЩИЕ ПОЛОЖЕНИЯ',
                    content: {
                        actions: [
                            { text: 'Знать основные понятия и определения бездоговорного/безучетного потребления' }
                        ],
                        keyPoints: [
                            'Договор считается заключенным с даты ТП или права собственности',
                            'Максимальный срок взыскания - 3 года',
                            'Потребление после расторжения договора = бездоговорное'
                        ],
                        responsible: 'Все сотрудники',
                        deadline: 'Постоянно'
                    }
                },
                {
                    id: 'info-activities',
                    title: 'ИНФОРМАЦИОННЫЕ МЕРОПРИЯТИЯ',
                    content: {
                        actions: [
                            {
                                text: 'Проводить профилактику через:',
                                list: [
                                    'Семинары и круглые столы',
                                    'Работу с СМИ',
                                    'Публикации на сайтах и соцсетях',
                                    'Информационные стенды'
                                ]
                            }
                        ],
                        responsible: 'СРУ совместно с пресс-службой',
                        deadline: 'По плану мероприятий'
                    }
                },
                {
                    id: 'parallel-connection',
                    title: 'ЗАКЛЮЧЕНИЕ ДОГОВОРА ПАРАЛЛЕЛЬНО С ТП',
                    content: {
                        steps: [
                            'Направить копии документов заявителя в ЭСК',
                            'Передать проект договора от ЭСК на УРРУ для подписания заявителем',
                            'После завершения ТП направить акты в ЭСК'
                        ],
                        deadlines: [
                            'Передача документов в ЭСК - 2 раб. дня с даты договора ТП',
                            'Передача актов после ТП - 2 раб. дня'
                        ],
                        responsible: 'СРУ, УРРУ',
                        control: 'Недопущение самовольного подключения'
                    }
                },
                {
                    id: 'no-contract-consumption',
                    title: 'ОПРЕДЕЛЕНИЕ ПОТРЕБЛЕНИЯ БЕЗ ДОГОВОРА',
                    content: {
                        steps: [
                            'Проверить наличие письменных договоров у всех потребителей',
                            'СРУ/УРРУ определяет объем потребления',
                            'Предъявить требования ГП по оплате услуг передачи'
                        ],
                        responsible: 'СРУ, УРРУ',
                        deadline: 'Через 2 месяца после принятия ГП потребителей'
                    }
                },
                {
                    id: 'restriction-control',
                    title: 'ВВЕДЕНИЕ ОГРАНИЧЕНИЯ И КОНТРОЛЬ',
                    content: {
                        steps: [
                            'Вводить ограничение способом, максимально препятствующим подключению',
                            'Приоритет - отключение на опоре ВЛ',
                            'Составить акт с фотофиксацией',
                            'При повторном выявлении - усилить технические меры (защитные кожухи, демонтаж оборудования, замена на СИП)'
                        ],
                        responsible: 'РЭС',
                        deadline: 'По заявкам на ограничение',
                        control: 'По графику проверок'
                    }
                },
                {
                    id: 'planning-detection',
                    title: 'ПЛАНИРОВАНИЕ ВЫЯВЛЕНИЯ НЕУЧТЕННОГО ПОТРЕБЛЕНИЯ',
                    content: {
                        actions: [
                            {
                                text: 'Действия УРРУ:',
                                list: [
                                    'Ежемесячный пофидерный анализ потерь',
                                    'Формирование группы риска потребителей',
                                    'Планирование рейдов'
                                ]
                            }
                        ],
                        riskCriteria: [
                            'Несоответствие потребления оборудованию',
                            'Необоснованный недопуск',
                            'Ранее уличенные в хищении',
                            'Потребители с введенным ограничением'
                        ],
                        responsible: 'УРРУ под контролем СРУ',
                        deadline: 'Ежемесячно',
                        raids: 'Минимум 1 раз в месяц в каждом РЭС'
                    }
                },
                {
                    id: 'consumption-analysis',
                    title: 'АНАЛИЗ ТЕКУЩЕГО ЭЛЕКТРОПОТРЕБЛЕНИЯ',
                    content: {
                        steps: [
                            'Анализ динамики потребления за предыдущие периоды',
                            'Расчет среднестатистического потребления по типам',
                            'Выбор фидеров с максимальными потерями (в относительных и абсолютных единицах)'
                        ],
                        responsible: 'УРРУ',
                        deadline: 'Перед каждым рейдом'
                    }
                },
                {
                    id: 'check-preparation',
                    title: 'ПОДГОТОВКА К ПРОВЕРКАМ',
                    content: {
                        sources: [
                            'Данные от ГП/ЭСК (п.123, 125 ПП РФ №442)',
                            'Обращения граждан (в т.ч. анонимные)',
                            'Визуальное обнаружение',
                            'Анализ потерь',
                            'Данные о введенных ограничениях',
                            'Анализ заявок на ТП'
                        ],
                        actions: [
                            {
                                text: 'Проверить полученную информацию'
                            }
                        ],
                        responsible: 'ФЭС, УРРУ',
                        deadline: 'В течение 1 рабочего дня с момента получения'
                    }
                },
                {
                    id: 'conducting-checks',
                    title: 'ПРОВЕДЕНИЕ ПРОВЕРОК',
                    content: {
                        steps: [
                            'Представиться, предъявить удостоверение',
                            'Разъяснить цель проверки',
                            'Произвести фото/видеофиксацию с датой и временем',
                            'Составить акт о неучтенном потреблении',
                            'Получить объяснения потребителя',
                            'Вручить копию акта'
                        ],
                        nonAdmission: [
                            'Составить акт недопуска с двумя свидетелями'
                        ],
                        consultations: 'При мощности >150 кВт или объеме >5000 кВтч - консультация СПСДФ в телефонном режиме',
                        responsible: 'Персонал РЭС/УРРУ',
                        deadline: 'На месте проверки'
                    }
                },
                {
                    id: 'calculation-unaccounted',
                    title: 'РАСЧЕТ БЕЗУЧЕТНОГО ПОТРЕБЛЕНИЯ (ЮРЛИЦА)',
                    content: {
                        period: 'От предыдущей проверки до выявления, максимум 4380 часов (6 месяцев)',
                        formulas: [
                            {
                                title: 'При наличии Pmax:',
                                formula: 'W = Pmax × T × 1,5'
                            },
                            {
                                title: 'При отсутствии Pmax:',
                                list: [
                                    'Однофазный: W = (Iдоп × Uф × cosφ × T) / 1000',
                                    'Трехфазный: W = (√3 × Iдоп × Uф × cosφ × T) / 1000'
                                ]
                            }
                        ],
                        parameters: [
                            'cosφ = 0,9 (при отсутствии данных)',
                            'Iдоп - по характеристикам кабеля',
                            'Uф = 0,22 кВ'
                        ],
                        correction: 'Вычесть ранее предъявленное к оплате',
                        responsible: 'Назначенное лицо СУЭ/СРУ/УРРУ',
                        deadline: '2 рабочих дня с даты акта'
                    }
                },
                {
                    id: 'calculation-unaccounted-phys',
                    title: 'РАСЧЕТ БЕЗУЧЕТНОГО ПОТРЕБЛЕНИЯ (ФИЗЛИЦА)',
                    content: {
                        unauthorizedConnection: [
                            'Период: до 3 месяцев до даты выявления',
                            'Расчет: по нормативу × 10'
                        ],
                        meterIntervention: [
                            'Период: с даты установки пломб, но не более 3 месяцев',
                            'Расчет: норматив × количество человек × 10'
                        ],
                        correction: [
                            'Вычесть ранее оплаченное (кроме случаев потребления мимо ПУ)',
                            'Уменьшение периода при документальном подтверждении отсутствия'
                        ],
                        responsible: 'Назначенное лицо СУЭ/СРУ/УРРУ',
                        deadline: '2 рабочих дня с даты акта'
                    }
                },
                {
                    id: 'contractless-calculation',
                    title: 'РАСЧЕТ БЕЗДОГОВОРНОГО ПОТРЕБЛЕНИЯ',
                    content: {
                        period: [
                            'Максимум 8760 часов (1 год)',
                            'От предыдущей проверки до выявления',
                            'При самовольном подключении - от предыдущей проверки ВЛ',
                            'При повторном подключении - от даты введения ограничения'
                        ],
                        formulas: [
                            {
                                title: 'Формулы:',
                                list: [
                                    'Однофазный: W = (Iдоп × Uф × cosφ × Tбд) / 1000',
                                    'Трехфазный: W = (√3 × Iдоп × Uф × cosφ × Tбд) / 1000'
                                ]
                            }
                        ],
                        pricing: [
                            'Население - по тарифам ДГРТ КК',
                            'Прочие - цена потерь + тариф на передачу'
                        ],
                        important: 'НЕ включается в объем оказанных услуг',
                        responsible: 'СРУ, УРРУ',
                        deadline: '2 рабочих дня с даты акта'
                    }
                },
                {
                    id: 'meter-malfunction',
                    title: 'ДЕЙСТВИЯ ПРИ НЕИСПРАВНОСТИ ПРИБОРОВ УЧЕТА',
                    content: {
                        steps: [
                            'Составить акт проверки по п.173 ПП №442',
                            'Обязательно использовать фото/видеофиксацию',
                            'Сделать перерасчет'
                        ],
                        recalculation: [
                            'По показаниям за аналогичный период прошлого года',
                            'При отсутствии - за ближайший период с показаниями',
                            'Для ИСУЭ - за последние 3 расчетных периода'
                        ],
                        responsible: 'СУЭ',
                        deadline: 'В момент проверки'
                    }
                },
                {
                    id: 'commission-review',
                    title: 'КОМИССИОННОЕ РАССМОТРЕНИЕ АКТОВ',
                    content: {
                        structure: [
                            'Комиссия УРРУ - первичное рассмотрение',
                            'Комиссия ФЭС - спорные вопросы и окончательные решения'
                        ],
                        composition: [
                            'Минимум 3 человека',
                            'В комиссию ФЭС входят: зам. директора по РРУ, представитель СПСДФ, представитель безопасности'
                        ],
                        tasks: [
                            'Проверка обоснованности и корректности актов',
                            'Утверждение расчетов',
                            'Передача актов в ЭСК/СПСДФ или на списание'
                        ],
                        timing: [
                            'Комиссия УРРУ - постоянно',
                            'Комиссия ФЭС - по необходимости',
                            'Передача в ЭСК - 3 рабочих дня с даты составления'
                        ],
                        documents: 'Все решения оформляются протоколом',
                        responsible: 'Председатели комиссий',
                        deadline: 'См. выше'
                    }
                },
                {
                    id: 'damage-compensation',
                    title: 'ВОЗМЕЩЕНИЕ УЩЕРБА ОТ БЕЗУЧЕТНОГО ПОТРЕБЛЕНИЯ',
                    content: {
                        steps: [
                            'РСК передает акт с расчетом в ЭСК',
                            'ЭСК включает в объем услуг и выставляет счет потребителю',
                            'При неоплате - ЭСК ведет претензионную работу',
                            'РСК участвует как 3-е лицо в суде'
                        ],
                        deadlines: [
                            'Передача в ЭСК - 3 рабочих дня',
                            'Реестр от ЭСК - ежемесячно'
                        ],
                        responsible: 'СРУ → ЭСК',
                        deadline: 'См. выше'
                    }
                },
                {
                    id: 'calculation-unaccounted',
                    title: 'РАСЧЕТ БЕЗУЧЕТНОГО ПОТРЕБЛЕНИЯ (ЮРЛИЦА)',
                    content: {
                        period: 'От предыдущей проверки до выявления, максимум 4380 часов (6 месяцев)',
                        formulas: [
                            {
                                title: 'При наличии Pmax:',
                                formula: 'W = Pmax × T × 1,5'
                            },
                            {
                                title: 'При отсутствии Pmax:',
                                list: [
                                    'Однофазный: W = (Iдоп × Uф × cosφ × T) / 1000',
                                    'Трехфазный: W = (√3 × Iдоп × Uф × cosφ × T) / 1000'
                                ]
                            }
                        ],
                        parameters: [
                            'cosφ = 0,9 (при отсутствии данных)',
                            'Iдоп - по характеристикам кабеля',
                            'Uф = 0,22 кВ'
                        ],
                        correction: 'Вычесть ранее предъявленное к оплате',
                        responsible: 'Назначенное лицо СУЭ/СРУ/УРРУ',
                        deadline: '2 рабочих дня с даты акта'
                    }
                },
                {
                    id: 'cost-recovery',
                    title: 'ВЗЫСКАНИЕ СТОИМОСТИ БЕЗДОГОВОРНОГО ПОТРЕБЛЕНИЯ',
                    content: {
                        steps: [
                            'Расчет стоимости (без НДС)',
                            'Передача в бухгалтерию для выставления счета',
                            'Вручение счета лицу'
                        ],
                        nonPayment: [
                            'Передача в СПСДФ через 10 дней после срока оплаты',
                            'СПСДФ направляет претензию - 5 рабочих дней',
                            'При отказе - иск в суд в течение 3 месяцев'
                        ],
                        documents: [
                            'Оригинал акта и расчета',
                            'Документы о периоде расчета',
                            'Фото/видеоматериалы',
                            'Подтверждение направления счета'
                        ],
                        responsible: 'СРУ → Бухгалтерия → СПСДФ',
                        deadline: 'См. выше'
                    }
                },
                {
                    id: 'law-enforcement',
                    title: 'ЗАЯВЛЕНИЯ В ПРАВООХРАНИТЕЛЬНЫЕ ОРГАНЫ',
                    content: {
                        timing: [
                            'Передать копию акта в подразделение безопасности - 4 рабочих дня',
                            'Безопасность готовит и направляет заявление - 3 рабочих дня'
                        ],
                        forms: [
                            'Физлица - Приложение 13',
                            'Юрлица/ИП - Приложение 14',
                            'Сумма >250 тыс. руб. - Приложение 14.1',
                            'После введения ограничения - Приложение 14.2',
                            'При мощности >150 кВт - Приложение 14.3'
                        ],
                        special: 'При сумме >250 тыс. - направить в департамент безопасности ИА',
                        responsible: 'Подразделение безопасности',
                        deadline: '7 рабочих дней с даты составления акта'
                    }
                },
                {
                    id: 'operational-control',
                    title: 'ОПЕРАТИВНЫЙ КОНТРОЛЬ',
                    content: {
                        steps: [
                            'Внести все акты в ПК "1С:Энергетика"',
                            'Формировать отчеты (приложения 9-12) в Excel',
                            'Сверять данные с реестрами ЭСК',
                            'Вести журналы учета актов'
                        ],
                        reporting: [
                            'Формат: Excel + скан с подписями',
                            'Направление: в УРУ департамента РУиУЭ ИА'
                        ],
                        storage: [
                            'Журналы и отчеты - 5 лет',
                            'Акты и скан-копии - 5 лет или до полной оплаты'
                        ],
                        responsible: 'СРУ, руководители РЭС',
                        deadline: 'До 18 числа месяца, следующего за отчетным'
                    }
                }
            ]
        };

        let expandedSections = new Set();

        function searchInObject(obj, searchTerm) {
            for (let key in obj) {
                if (obj.hasOwnProperty(key)) {
                    const value = obj[key];
                    if (typeof value === 'string') {
                        if (value.toLowerCase().includes(searchTerm)) {
                            return true;
                        }
                    } else if (Array.isArray(value)) {
                        for (let item of value) {
                            if (typeof item === 'string' && item.toLowerCase().includes(searchTerm)) {
                                return true;
                            } else if (typeof item === 'object' && searchInObject(item, searchTerm)) {
                                return true;
                            }
                        }
                    } else if (typeof value === 'object' && value !== null) {
                        if (searchInObject(value, searchTerm)) {
                            return true;
                        }
                    }
                }
            }
            return false;
        }

        function renderContent() {
            const container = document.getElementById('contentContainer');
            const selectedReglament = document.getElementById('reglamentSelect').value;
            const searchTerm = document.getElementById('searchInput').value.toLowerCase().trim();
            
            container.innerHTML = '';
            
            if (!algorithms[selectedReglament]) {
                container.innerHTML = '<div class="no-results">Регламент не найден</div>';
                return;
            }
            
            let filteredAlgorithms = algorithms[selectedReglament];
            
            if (searchTerm) {
                filteredAlgorithms = algorithms[selectedReglament].filter(algo => {
                    return searchInObject(algo, searchTerm);
                });
            }
            
            if (filteredAlgorithms.length === 0) {
                container.innerHTML = '<div class="no-results">По вашему запросу ничего не найдено</div>';
                return;
            }
            
            filteredAlgorithms.forEach(algo => {
                const section = createSection(algo, searchTerm);
                container.appendChild(section);
            });
        }

        function createSection(algo, searchTerm) {
            const card = document.createElement('div');
            card.className = 'section-card';
            
            const header = document.createElement('div');
            header.className = 'section-header';
            header.onclick = () => toggleSection(algo.id);
            
            const title = document.createElement('div');
            title.className = 'section-title';
            title.innerHTML = highlightText(algo.title, searchTerm);
            
            const arrow = document.createElement('div');
            arrow.className = 'section-arrow';
            arrow.innerHTML = '▼';
            if (expandedSections.has(algo.id)) {
                arrow.classList.add('expanded');
            }
            
            header.appendChild(title);
            header.appendChild(arrow);
            
            const content = document.createElement('div');
            content.className = 'section-content';
            content.id = `content-${algo.id}`;
            if (expandedSections.has(algo.id)) {
                content.classList.add('expanded');
            }
            
            // Порядок действий
            if (algo.content.steps) {
                const block = createBlock('Порядок действий:', algo.content.steps, searchTerm, true);
                content.appendChild(block);
            }
            
            // Действия
            if (algo.content.actions) {
                algo.content.actions.forEach(action => {
                    const actionDiv = document.createElement('div');
                    actionDiv.className = 'algorithm-block';
                    actionDiv.innerHTML = `<h4>${highlightText(action.text, searchTerm)}</h4>`;
                    
                    if (action.list) {
                        const ul = document.createElement('ul');
                        action.list.forEach(item => {
                            const li = document.createElement('li');
                            li.innerHTML = highlightText(item, searchTerm);
                            ul.appendChild(li);
                        });
                        actionDiv.appendChild(ul);
                    }
                    
                    content.appendChild(actionDiv);
                });
            }
            
            // Ключевые моменты
            if (algo.content.keyPoints) {
                const block = createBlock('Ключевые моменты:', algo.content.keyPoints, searchTerm);
                content.appendChild(block);
            }
            
            // Критерии риска
            if (algo.content.riskCriteria) {
                const block = createBlock('Критерии группы риска:', algo.content.riskCriteria, searchTerm);
                content.appendChild(block);
            }
            
            // Рейды
            if (algo.content.raids) {
                const block = document.createElement('div');
                block.className = 'algorithm-block';
                block.innerHTML = `<h4>Рейды:</h4><p>${highlightText(algo.content.raids, searchTerm)}</p>`;
                content.appendChild(block);
            }
            
            // Период расчета
            if (algo.content.period) {
                const block = document.createElement('div');
                block.className = 'algorithm-block';
                block.innerHTML = `<h4>Период расчета:</h4><p>${highlightText(algo.content.period, searchTerm)}</p>`;
                content.appendChild(block);
            }
            
            // Формулы
            if (algo.content.formulas) {
                algo.content.formulas.forEach(f => {
                    const block = document.createElement('div');
                    block.className = 'algorithm-block';
                    block.innerHTML = `<h4>${f.title}</h4>`;
                    
                    if (f.formula) {
                        block.innerHTML += `<p><code>${f.formula}</code></p>`;
                    }
                    
                    if (f.list) {
                        const ul = document.createElement('ul');
                        f.list.forEach(item => {
                            const li = document.createElement('li');
                            li.innerHTML = `<code>${item}</code>`;
                            ul.appendChild(li);
                        });
                        block.appendChild(ul);
                    }
                    
                    content.appendChild(block);
                });
            }
            
            // Параметры
            if (algo.content.parameters) {
                const block = createBlock('Параметры:', algo.content.parameters, searchTerm);
                content.appendChild(block);
            }
            
            // Источники информации
            if (algo.content.sources) {
                const block = createBlock('Источники информации:', algo.content.sources, searchTerm);
                content.appendChild(block);
            }
            
            // При несанкционированном подключении
            if (algo.content.unauthorizedConnection) {
                const block = createBlock('При несанкционированном подключении (п.62 ПП РФ №354):', algo.content.unauthorizedConnection, searchTerm);
                content.appendChild(block);
            }
            
            // При вмешательстве в прибор учета
            if (algo.content.meterIntervention) {
                const block = createBlock('При вмешательстве в прибор учета (п.81(11) ПП РФ №354):', algo.content.meterIntervention, searchTerm);
                content.appendChild(block);
            }
            
            // При недопуске
            if (algo.content.nonAdmission) {
                const block = createBlock('При недопуске:', algo.content.nonAdmission, searchTerm);
                content.appendChild(block);
            }
            
            // Стоимость
            if (algo.content.pricing) {
                const block = createBlock('Стоимость:', algo.content.pricing, searchTerm);
                content.appendChild(block);
            }
            
            // Важно
            if (algo.content.important) {
                const block = document.createElement('div');
                block.className = 'algorithm-block';
                block.innerHTML = `<h4 style="color: #dc3545;">Важно:</h4><p><strong>${highlightText(algo.content.important, searchTerm)}</strong></p>`;
                content.appendChild(block);
            }
            
            // Перерасчет
            if (algo.content.recalculation) {
                const block = createBlock('Перерасчет:', algo.content.recalculation, searchTerm);
                content.appendChild(block);
            }
            
            // Состав
            if (algo.content.composition) {
                const block = createBlock('Состав:', algo.content.composition, searchTerm);
                content.appendChild(block);
            }
            
            // Задачи комиссии
            if (algo.content.tasks) {
                const block = createBlock('Задачи комиссии:', algo.content.tasks, searchTerm);
                content.appendChild(block);
            }
            
            // Сроки работы
            if (algo.content.timing) {
                const block = createBlock('Сроки:', algo.content.timing, searchTerm);
                content.appendChild(block);
            }
            
            // Структура
            if (algo.content.structure) {
                const block = createBlock('Структура комиссий:', algo.content.structure, searchTerm);
                content.appendChild(block);
            }
            
            // Консультации
            if (algo.content.consultations) {
                const block = document.createElement('div');
                block.className = 'algorithm-block';
                block.innerHTML = `<h4>Консультации:</h4><p>${highlightText(algo.content.consultations, searchTerm)}</p>`;
                content.appendChild(block);
            }
            
            // Документы (для протокола)
            if (algo.content.documents && typeof algo.content.documents === 'string') {
                const block = document.createElement('div');
                block.className = 'algorithm-block';
                block.innerHTML = `<h4>Документы:</h4><p>${highlightText(algo.content.documents, searchTerm)}</p>`;
                content.appendChild(block);
            }
            
            if (algo.content.deadlines) {
                const block = createBlock('Сроки:', algo.content.deadlines, searchTerm);
                content.appendChild(block);
            }
            
            // При неоплате
            if (algo.content.nonPayment) {
                const block = createBlock('При неоплате:', algo.content.nonPayment, searchTerm);
                content.appendChild(block);
            }
            
            // Документы
            if (algo.content.documents) {
                const block = createBlock('Документы для СПСДФ:', algo.content.documents, searchTerm);
                content.appendChild(block);
            }
            
            // Формы заявлений
            if (algo.content.forms) {
                const block = createBlock('Формы заявлений:', algo.content.forms, searchTerm);
                content.appendChild(block);
            }
            
            // Отчетность
            if (algo.content.reporting) {
                const block = createBlock('Отчетность:', algo.content.reporting, searchTerm);
                content.appendChild(block);
            }
            
            // Хранение
            if (algo.content.storage) {
                const block = createBlock('Хранение:', algo.content.storage, searchTerm);
                content.appendChild(block);
            }
            
            // Особый порядок
            if (algo.content.special) {
                const block = document.createElement('div');
                block.className = 'algorithm-block';
                block.innerHTML = `<h4>Особый порядок:</h4><p>${highlightText(algo.content.special, searchTerm)}</p>`;
                content.appendChild(block);
            }
            
            // Корректировка
            if (algo.content.correction) {
                const block = document.createElement('div');
                block.className = 'algorithm-block';
                block.innerHTML = `<h4>Корректировка:</h4><p>${highlightText(algo.content.correction, searchTerm)}</p>`;
                content.appendChild(block);
            }
            
            // Контроль
            if (algo.content.control) {
                const block = document.createElement('div');
                block.className = 'algorithm-block';
                block.innerHTML = `<h4>Контроль:</h4><p>${highlightText(algo.content.control, searchTerm)}</p>`;
                content.appendChild(block);
            }
            
            // Ответственный и Срок
            const footer = document.createElement('div');
            footer.className = 'algorithm-block';
            if (algo.content.responsible) {
                footer.innerHTML += `<p><strong>Ответственный:</strong> ${highlightText(algo.content.responsible, searchTerm)}</p>`;
            }
            if (algo.content.deadline) {
                footer.innerHTML += `<p><strong>Срок:</strong> ${highlightText(algo.content.deadline, searchTerm)}</p>`;
            }
            if (footer.innerHTML) {
                content.appendChild(footer);
            }
            
            // Кнопки действий
            const buttons = document.createElement('div');
            buttons.className = 'action-buttons';
            
            const attachBtn = document.createElement('button');
            attachBtn.className = 'action-btn btn-success';
            attachBtn.innerHTML = '📎 Загрузить приложение';
            attachBtn.onclick = () => alert('Функция загрузки приложений будет добавлена позже');
            
            const openBtn = document.createElement('button');
            openBtn.className = 'action-btn btn-primary';
            openBtn.innerHTML = '📄 Открыть регламент';
            openBtn.onclick = () => openSourceDocument(algo.id);
            
            const collapseBtn = document.createElement('button');
            collapseBtn.className = 'action-btn btn-secondary';
            collapseBtn.innerHTML = '↑ Свернуть';
            collapseBtn.onclick = () => toggleSection(algo.id);
            
            buttons.appendChild(attachBtn);
            buttons.appendChild(openBtn);
            buttons.appendChild(collapseBtn);
            
            content.appendChild(buttons);
            
            card.appendChild(header);
            card.appendChild(content);
            
            return card;
        }

        function createBlock(title, items, searchTerm, ordered = false) {
            const block = document.createElement('div');
            block.className = 'algorithm-block';
            block.innerHTML = `<h4>${title}</h4>`;
            
            const list = ordered ? document.createElement('ol') : document.createElement('ul');
            items.forEach(item => {
                const li = document.createElement('li');
                li.innerHTML = highlightText(item, searchTerm);
                list.appendChild(li);
            });
            block.appendChild(list);
            
            return block;
        }

        function highlightText(text, searchTerm) {
            if (!searchTerm || !text) return text;
            const regex = new RegExp(`(${searchTerm})`, 'gi');
            return text.replace(regex, '<span class="highlight">$1</span>');
        }

        function toggleSection(sectionId) {
            const content = document.getElementById(`content-${sectionId}`);
            const arrow = content.previousElementSibling.querySelector('.section-arrow');
            
            if (expandedSections.has(sectionId)) {
                expandedSections.delete(sectionId);
                content.classList.remove('expanded');
                arrow.classList.remove('expanded');
            } else {
                expandedSections.add(sectionId);
                content.classList.add('expanded');
                arrow.classList.add('expanded');
            }
        }

        function collapseAll() {
            document.querySelectorAll('.section-content').forEach(content => {
                content.classList.remove('expanded');
            });
            document.querySelectorAll('.section-arrow').forEach(arrow => {
                arrow.classList.remove('expanded');
            });
            expandedSections.clear();
        }

        function openSourceDocument(sectionId) {
            const modal = document.getElementById('sourceModal');
            const sourceText = document.getElementById('sourceText');
            
            // Здесь будет логика загрузки соответствующего раздела из документа
            sourceText.innerHTML = `
                <p><strong>Раздел документа для: ${sectionId}</strong></p>
                <p>Здесь будет отображаться соответствующий раздел из исходного регламента.</p>
                <p>Функция будет реализована после интеграции с исходным документом.</p>
            `;
            
            modal.style.display = 'block';
        }

        // Event listeners
        document.getElementById('reglamentSelect').addEventListener('change', renderContent);
        document.getElementById('searchInput').addEventListener('input', renderContent);
        document.getElementById('collapseAllBtn').addEventListener('click', collapseAll);
        document.getElementById('scrollTopBtn').addEventListener('click', () => {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Модальное окно
        document.querySelector('.close-modal').addEventListener('click', () => {
            document.getElementById('sourceModal').style.display = 'none';
        });

        window.addEventListener('click', (event) => {
            const modal = document.getElementById('sourceModal');
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        });

        // Показываем/скрываем кнопку "Наверх" при прокрутке
        window.addEventListener('scroll', () => {
            const scrollTopBtn = document.getElementById('scrollTopBtn');
            if (window.pageYOffset > 300) {
                scrollTopBtn.style.display = 'flex';
            } else {
                scrollTopBtn.style.display = 'none';
            }
        });

        // Инициализация
        renderContent();
    </script>
</body>
</html>
